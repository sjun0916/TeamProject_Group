<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mail">


 	<insert id="insert" parameterType="com.group.mail.vo.MailVo">

 		INSERT INTO MAIL( 
 		MAILNUM, 
 		SENDER_MAIL, 
 		RECEIVER_MAIL, 
 		TITLE, 
 		CONTENT, 
 		REGDATE) 
 		VALUES ( 
 		MAIL_SEQ.NEXTVAL, 
 		#{senderMail}, 
 		#{receiverMail}, 
 		#{title}, 
 		#{content}, 
 		SYSDATE 
 		)

 	</insert> 
		
	
	<select id="getEmail" resultType="com.group.mail.vo.MailVo" parameterType="UserVo">
		SELECT RECEIVER_MAIL receiverMail,
		SENDER_MAIL senderMail,
		MAIL_NUM mailNum,
		(
		SELECT EMAIL
		FROM EMPLOYEE
		WHERE EMAIL = MAIL.SENDER_MAIL) SENDER,
		MESSAGE_CONTENT message,
		REGDATE REGDATE
		FROM MAIL
		WHERE RECEIVER_MAIL = #{email}
		ORDER
		BY REGDATE DESC
	</select>

	<select id="listDepart" resultType="UserVO" parameterType="String">
		select MEMBERJOIN.MEMBER_ENUM
			  ,DEPARTMENTCODE.DEP_NAME
			  ,RANKCODE.RANK_NAME 
			  ,MEMBERJOIN.MEMBER_EMAIL
			  ,MEMBERJOIN.MEMBER_PHONE
			  ,MEMBERJOIN.MEMBER_ADRESS
			  ,MEMBERJOIN.MEMBER_BIRTH
			  ,MEMBERJOIN.MEMBER_PROFILE
			  ,MEMBERJOIN.MEMBER_REGDATE
			  ,MEMBERJOIN.MEMBER_RESIGNATIONDATE
			  ,MEMBERJOIN.MEMBER_SIGN
			  ,MEMBERJOIN.MEMBER_NAME		  
		from MEMBERJOIN
		INNER JOIN RANKCODE ON (MEMBERJOIN.MEMBER_RANK = RANKCODE.RANK_ID)
		INNER JOIN DEPARTMENTCODE ON (MEMBERJOIN.MEMBER_DEPARTMENT = DEPARTMENTCODE.DEP_ID)
		WHERE MEMBER_RANK = 
		(select member_rank
		from MEMBERJOIN 
		where MEMBER_ENUM = #{member_department})
		order by member_enum desc
	</select>


	<select id="getEmails" resultType="String" parameterType="map">
		select EMAIL from EMPLOYEE where EMPLOYEE_NO in 
		<foreach collection="email" item="item" index="index" separator="," open="(" close=")">
		#{item}
		</foreach>
	</select>
	
</mapper>
